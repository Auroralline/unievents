# UniEvents-琅琊青年夜校线上预约平台

## 项目简介

`UniEvents` 以临沂市青协举办青年夜校的场景为原型，是一个为“城市青年夜校”场景设计的线上课程预约平台。项目旨在模拟真实生产环境，为城市青年提供一个集文化艺术、职业技能、生活美学等多样化课程的线上预约渠道。项目重点解决了高并发场景下的**系统稳定性、数据一致性和用户体验**等核心问题。通过将复杂的业务场景进行微服务拆分，并应用多种技术手段，为平台的可靠运行提供了有力保障。

## 测试工作

测试用例设计：https://blog.csdn.net/Auroral__/article/details/148640688

1. **功能测试**: 以**端到端的业务场景**为核心，设计并执行了从“用户注册、登录、浏览课程、报名到支付”的完整业务流程用例，以此验证多个微服务在真实用户场景下的协同工作的正确性，确保核心功能的端到端质量。
2. **接口测试**: 基于 **Postman** 等工具，对各微服务暴露的API进行了全面的**黑盒测试**，不仅覆盖了正常调用的场景，更重点设计了异常参数、逻辑错误、权限校验等多种情况的测试用例，以此保障单个API对外服务的健壮性和可靠性。
3. **性能测试**: 针对课程报名这一核心高并发场景，使用压力测试工具模拟了大量用户同时请求的情况，重点验证了基于 **Redis+Lua** 的库存控制方案在高并发下的**数据一致性与原子性**，确保了系统的稳定性和防超卖逻辑的有效性。

## 主要工作

- **多级防刷与安全注册**
  - **业务场景**: 热门课程上线时，为防止机器人批量注册账号，需建立有效的防刷机制。
  - 技术实现:
    - 设计了图形验证码基础组件，通过 **Lua + Redis** 组合，实现了可根据实时并发量动态开启的图形验证码功能。
    - 结合**请求计数器**拦截短时高频请求，并利用**布隆过滤器**快速判断用户是否已注册，有效防止了缓存穿透和数据库压力。
  - **成果**: 该机制能有效拦截恶意注册行为，在保障正常用户体验的同时，提升了注册接口的安全性和稳定性。
- **分布式ID生成方案**
  - **业务场景**: 在分库分表的微服务架构下，需要全局唯一的ID来标识订单、用户等核心数据。
  - 技术实现:
    - 基于**雪花算法（Snowflake）** 设计了分布式ID生成服务。
    - 为解决多实例部署时 `WorkerId` 和 `DataCenterId` 的冲突问题，利用 **Lua + Redis** 的原子性操作进行ID的自动、安全分配，弥补了 `MyBatis-Plus` 自带ID生成器在分布式场景下的不足。
  - **成果**: 确保了在分布式、高并发环境下ID的唯一性和趋势递增，为数据一致性提供了基础。
- **高并发下的课程名额控制**
  - **业务场景**: 热门课程报名时，需确保课程名额在瞬时高并发请求下不会被超额预定。
  - 技术实现:
    - 利用 **Redis 的原子性**以及 **Lua 脚本**，将“读库存”和“写库存”两个操作合并为一个原子操作。
    - 在高并发环境下，所有库存扣减请求在Redis中串行执行，确保了数据的强一致性，有效防止了超卖问题。
  - **成果**: 成功支撑了高并发场景下的课程报名，保证了库存数据的准确无误。
- **多级缓存架构提升响应速度**
  - **业务场景**: 热门课程、讲师信息等数据被频繁访问，需要优化数据查询速度，提升用户体验。
  - 技术实现:
    - 构建了**多级缓存体系**：使用 `Caffeine` 作为JVM本地缓存，存储热度最高的数据；使用 `Redis` 作为二级分布式缓存，存储全量的热点数据。
    - 通过多级缓存的设计，大部分数据请求可在缓存层直接命中，极大降低了对后端数据库的访问压力。
  - **成果**: 显著降低了热点数据的查询延迟，核心接口的响应时间得到大幅优化。
- **高性能的课程搜索引擎**
  - **业务场景**: 用户需要根据课程名称、讲师、领域、时间等多个维度进行快速、准确的搜索。
  - 技术实现:
    - 引入 **Elasticsearch** 构建课程智能搜索引擎。
    - 支持多维度筛选、全文检索、模糊匹配及相关性排序等复杂查询。
  - **成果**: 将复杂搜索的平均响应时间从**2-3秒显著降低至200ms以内**，极大地提升了用户搜索体验。

## 技术栈概览

- **后端技术**: Spring Boot 3, Spring Cloud Alibaba, MyBatis-Plus
- **数据库与缓存**: MySQL, Redis,  Caffeine
- **搜索引擎**: Elasticsearch
- **开发工具**: Docker, Swagger, Knife4j, Maven

## 项目结构

`unievents` 项目采用模块化的方式组织，主要分为以下几个部分：

| 模块                                   | 描述                                                         |
| -------------------------------------- | ------------------------------------------------------------ |
| **unievents-common**                   | 存放了项目范围内的通用工具类、枚举、常量以及自定义异常，为其他模块提供了可复用的基础组件。 |
| **unievents-server-client**            | 包含所有微服务对外暴露的 Feign 客户端接口，定义了服务间的通信契约。 |
| **unievents-server**                   | 包含了项目核心的业务微服务，是整个平台功能实现的主体。       |
| **unievents-spring-cloud-framework**   | 包含了项目自研的Spring Cloud相关框架和组件。                 |
| **unievents-redis-tool-framework**     | 封装了对Redis的通用操作，包括基础的键值操作和对Redis Stream的支持。 |
| **unievents-elasticsearch-framework**  | 提供了对Elasticsearch的封装，支持数据的索引、查询和聚合等操作。 |
| **unievents-id-generator-framework**   | 一个分布式ID生成器，基于百度UidGenerator进行改造，确保在高并发场景下ID的唯一性。 |
| **unievents-thread-pool-framework**    | 对线程池进行了封装，并支持最终链路的traceId，便于问题的追踪和排查。 |
| **unievents-redisson-framework**       | 提供了基于Redisson的分布式服务工具，包括延迟队列、分布式锁、布隆过滤器等。 |
| **unievents-captcha-manage-framework** | 一个验证码管理框架，提供了验证码的生成、校验和管理等功能。   |